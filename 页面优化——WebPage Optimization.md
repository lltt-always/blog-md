---
title: 页面优化——WebPage Optimization
tags: CSS
---

多个页面优化中的建议

<!--more-->

# 减少HTTP请求次数

  对于图片，使用CSS Spirits方法对一张大图片进行切图，主要使用CSS的两个属性，background-image和background-position

  对于脚本和样式，合并脚本和样式文件（combo），对于不同的网页类型，有不同的加载策略
  - 内容型：合并脚本文件放在body底部
  - 应用型：按需加载脚本
  
  减少HTTP请求的优点：
  - 减少DNS请求和解析耗费的时间
  - 减少服务器压力
  - 减少HTTP请求头，从而减小对带宽的占用

# 减少DNS查找次数

当客户端中的DNS缓存都为空时（浏览器和操作系统都为空），DNS查找的次数和页面中主机名的数量相同。这其中包括页面中URL、图片、脚本文件、样式表、Flash对象等包含的主机名。减少主机名的数量可以减少DNS查找次数，节省响应时间。

但是减少主机名会减少页面中的并行下载数量，会增加下载时间，所以DNS查找次数的减少方案需要权衡下载时间与响应时间。

# 避免跳转

在用户和HTML文档中间增加一个跳转回拖延页面中所有元素的显示，因为在HTM：文件被加载前任何文件（图像、Flash等）都不会被下载。

有一种经常被网页开发者忽略却往往十分浪费响应时间的跳转现象。这种现象发生在当URL本该有斜杠（/）却被忽略掉时。例如，当我们要访问http://astrology.yahoo.com/astrology 时，实际上返回的是一个包含301代码的跳转，它指向的是http://astrology.yahoo.com/astrology/  （注意末尾的斜杠）。

连接新网站和旧网站是跳转功能经常被用到的另一种情况。这种情况下往往要连接网站的不同内容然后根据用户的不同类型（如浏览器类型、用户账号所属类型）来进行跳转。使用跳转来实现两个网站的切换十分简单，需要的代码量也不多。尽管使用这种方法对于开发者来说可以降低复杂程度，但是它同样降低用户体验。一个可替代方法就是如果两者在同一台服务器上时使用Alias和mod_rewrite和实现。如果是因为域名的不同而采用跳转，那么可以通过使用Alias或者mod_rewirte建立CNAME（保存一个域名和另外一个域名之间关系的DNS记录）来替代。

# 可缓存的Ajax

为了提高性能，优化Ajax响应是很重要的。提高Ajxa性能的措施中最重要的方法就是使响应具有可缓存性，具体的讨论可以查看Add an Expires or a Cache-Control Header。

# 推迟加载内容

把整个过程按照onload事件分割成两部分，onload前加载页面必须项，onload加载可延迟项。工具可以节省你的工作量：YUI Image Loader可以帮你推迟加载折叠部分的图片， YUI Get utility是包含JS和 CSS的便捷方法。

# 预加载

预加载是在浏览器空闲时请求将来可能会用到的页面内容（如图像、样式表和脚本）。

下面提供了几种预加载方法： 
无条件加载：触发onload事件时，直接加载额外的页面内容，如Google.com。
有条件加载：根据用户的操作来有根据地判断用户下面可能去往的页面并相应的预加载页面内容，如search.yahoo.com。

# 减少DOM元素数量

过多的DOM元素会是的Javascript便利DOM的效率减慢，因此要适当减少DOM数量。
YUI CSS utilities可以给你的布局带来巨大帮助：grids.css可以帮你实现整体布局，font.css和reset.css可以帮助你移除浏览器默认格式。它提供了一个重新审视你页面中标签的机会，比如只有在语意上有意义时才使用`<div>`，而不是因为它具有换行效果才使用它。 

`document.getElementsByTagName('*').length `能够计算页面中有多少个DOM元素

# 根据域名划分页面内容

由于浏览器对同一域名的下载数量有限制，把页面内容划分成若干部门可以大幅减少下载时间，但同时要考虑DNS查找的影响，所以最好把域名数量控制在2到4个。

例如，你可以把用到的HTML内容和动态内容放在www.example.org上，而把页面各种组件（图片、脚本、CSS)分别存放在statics1.example.org和statics.example.org上。 
你可在Tenni Theurer和Patty Chi合写的文章Maximizing Parallel Downloads in the Carpool Lane找到更多相关信息。

# 使iframe的数量最小

iframe多用来在网页中加载广告

优点：

- 解决加载缓慢的第三方内容如图标和广告等的加载问题 
- Security sandbox 
- 并行加载脚本 

缺点：

- 即时内容为空，加载也需要时间 
- 会阻止页面加载 
- 没有语意 

# 不要出现404错误

# 使用内容分发网络（Content  Delivery Network）

内容较复杂，可稍后研究

# 为文件头指定Expires或Cache-Control

对于静态内容：设置文件头过期时间Expires的值为“Never expire”（永不过期） 
对于动态内容：使用恰当的Cache-Control文件头来帮助浏览器进行有条件的请求 

# Gzip压缩文件内容

减小HTTP响应的大小可以节省HTTP响应时间，HTTP请求中有Accept-Encoding: gzip, deflate字段来设这文件压缩格式，如果web服务器在请求的文件头中检测到上面的代码，就会以客户端列出的方式压缩响应内容。
服务器根据文件类型来选择需要进行gzip压缩的文件，但是这过于限制了可压缩的文件。大多数web服务器会压缩HTML文档。对脚本和样式表进行压缩同样也是值得做的事情，但是很多web服务器都没有这个功能。实际上，压缩任何一个文本类型的响应，包括XML和JSON，都值得的。图像和PDF文件由于已经压缩过了所以不能再进行gzip压缩。如果试图gizp压缩这些文件的话不但会浪费CPU资源还会增加文件的大小。 
Gzip压缩所有可能的文件类型是减少文件体积增加用户体验的简单方法。

# 配置Etag

是web服务器和浏览器用于判断浏览器缓存中的内容和服务器中的原始内容是否匹配的一种机制
```
HTTP/1.1 200 OK 
Last-Modified: Tue, 12 Dec 2006 03:03:59 GMT 
ETag: "10c24bc-4ab-457e1c1f" 
Content-Length: 12195 
```
稍后，如果浏览器要验证一个文件，它会使用If-None-Match文件头来把ETag传回给原始服务器。在这个例子中，如果ETag匹配，就会返回一个304状态码，这就节省了12195字节的响应。
ETag的问题在于，它是根据可以辨别网站所在的服务器的具有唯一性的属性来生成的。当浏览器从一台服务器上获得页面内容后到另外一台服务器上进行验证时ETag就会不匹配，这种情况对于使用服务器组和处理请求的网站来说是非常常见的。默认情况下，Apache和IIS都会把数据嵌入ETag中，这会显著减少多服务器间的文件验证冲突。  